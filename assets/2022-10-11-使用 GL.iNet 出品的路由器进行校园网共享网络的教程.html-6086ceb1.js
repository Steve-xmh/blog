import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as a,o as r,c as o,f as d,a as e,b as n,d as t,e as s}from"./app-be572551.js";const c={},u=e("blockquote",null,[e("p",null,"警告：本文仅作学习记录留档用途，请勿用于非法牟利甚至违法用途，否则后果自行承担")],-1),p=e("blockquote",null,[e("p",null,"本文为了能够持续留档不被不可抗力影响导致无法查看，将会被备份到网络档案库中，届时大家可以自行搜索查询")],-1),v=e("p",null,"因为本人购买的是他们家的路由器来实现校园网共享（给自己树莓派挂机器人和自己本体电脑用），所以特别在这里留下笔记，方便以后留给有缘人来实现网络自由。当然理论上其实各个支持刷入 OpenWRT 的路由器都能使用本方法配置，具体看大家的实际情况了。",-1),b=e("h2",{id:"材料购买",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#材料购买","aria-hidden":"true"},"#"),n(" 材料购买")],-1),m=e("p",null,"通过共享网络，你可以为",-1),_={href:"https://glinet.tmall.com/index.htm?spm=a1z10.1-b-s.w5002-22922268486.2.3ff53a74u2HL9v",target:"_blank",rel:"noopener noreferrer"},h={href:"https://detail.tmall.com/item.htm?id=662583133379",target:"_blank",rel:"noopener noreferrer"},g=e("li",null,"如果想要给全宿舍提供有线网络，可以选购一个交换机和一堆网线，但为了方便还是留一个网口给主管理电脑使用比较合适",-1),x=e("h2",{id:"第-1-步-mac-克隆到主要的路由器管理用电脑",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#第-1-步-mac-克隆到主要的路由器管理用电脑","aria-hidden":"true"},"#"),n(" 第 1 步：MAC 克隆到主要的路由器管理用电脑")],-1),R=e("p",null,"因为校园网需要鉴权登录，为了尽量避免麻烦先把路由器的 MAC 地址与主管理电脑的 MAC 调整为一致，方便突发意外时快速拆解重接主电脑到校园网上。",-1),f={href:"http://192.168.8.1/",target:"_blank",rel:"noopener noreferrer"},A=e("figure",null,[e("img",{src:"https://user-images.githubusercontent.com/39523898/195104073-2c3bdb54-d712-40d8-a80d-e3f9aa0aded8.png",alt:"更多设置 -> MAC 地址克隆",tabindex:"0",loading:"lazy"}),e("figcaption",null,"更多设置 -> MAC 地址克隆")],-1),P=e("p",null,"之后调整为本机 MAC 应用即可",-1),y=e("h2",{id:"第-2-步-配置-luci-和-privoxy-网络代理隐藏-user-agent-头",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#第-2-步-配置-luci-和-privoxy-网络代理隐藏-user-agent-头","aria-hidden":"true"},"#"),n(" 第 2 步：配置 LuCI 和 Privoxy 网络代理隐藏 User Agent 头")],-1),T={href:"https://lilynas.com/archives/644/",target:"_blank",rel:"noopener noreferrer"},U=s(`<p>SSH 连接到路由器，慢慢敲下面的来安装所需的东西：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>opkg update
opkg <span class="token function">install</span> luci
opkg <span class="token function">install</span> privoxy
opkg <span class="token function">install</span> luci-app-privoxy
opkg <span class="token function">install</span> luci-i18n-base-zh-cn
opkg <span class="token function">install</span> luci-i18n-privoxy-zh-cn
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),k={href:"http://192.168.8.1/cgi-bin/luci/admin/services/privoxy",target:"_blank",rel:"noopener noreferrer"},E=s(`<p>在 访问控制 子页面里：</p><ul><li>修改 Listen addresses 为 <code>192.168.8.1:8118</code></li><li>修改 Permit access 为 <code>192.168.8.0/24</code></li></ul><figure><img src="https://user-images.githubusercontent.com/39523898/195115772-96deca3e-f299-4a54-9095-03f1bb610cf9.png" alt="访问控制 子页面" tabindex="0" loading="lazy"><figcaption>访问控制 子页面</figcaption></figure><p>在 杂项 子页面里：</p><ul><li>勾选 Accept intercepted requests</li></ul><figure><img src="https://user-images.githubusercontent.com/39523898/195115925-d98d9c96-5125-486b-8535-41f6a150c9a9.png" alt="杂项 子页面" tabindex="0" loading="lazy"><figcaption>杂项 子页面</figcaption></figure><p>接下来使用 WinSCP 连接到路由器，然后前往 <code>/etc/privoxy</code> 目录，修改 <code>user.action</code> 和 <code>user.filter</code> 这两个文件：</p><p><code>user.action</code> 文件，在尾部增加以下内容：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>{+client-header-filter{androidfilter}}
/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><code>user.filter</code> 文件，在尾部添加以下内容：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CLIENT-HEADER-FILTER: androidfilter Replace all &quot;Android&quot; with &quot;Windows&quot;
s@\\b(Android|iP\\w+)\\b@Windows NT@ig
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,11),N={href:"http://192.168.8.1/cgi-bin/luci/admin/services/privoxy",target:"_blank",rel:"noopener noreferrer"},q=e("figure",null,[e("img",{src:"https://user-images.githubusercontent.com/39523898/195115328-05bc4f98-27ef-4c2a-b4c2-986490adb4af.png",alt:"Privoxy 网络代理",tabindex:"0",loading:"lazy"}),e("figcaption",null,"Privoxy 网络代理")],-1),F={href:"http://192.168.8.1/cgi-bin/luci/admin/network/firewall/custom",target:"_blank",rel:"noopener noreferrer"},O=s(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># OpenWRT 防火墙自定义修改 TTL 值
iptables -t mangle -A PREROUTING -i eth0.2 -j TTL --ttl-set 64
iptables -t mangle -A PREROUTING -i br-lan -j TTL --ttl-set 64

# OpenWRT 防火墙自定义设置拒绝 AC 检测
iptables -I FORWARD -p tcp --sport 80 --tcp-flags ACK ACK -m string --algo bm --string &quot; src=\\&quot;http://1.1.1.&quot; -j DROP
iptables -I FORWARD -p tcp -m tcp --sport 80 -m u32 --u32 &quot;5&amp;0xFF=0x7F&quot; -j DROP
iptables -I FORWARD -p tcp -m tcp --sport 8000 -m u32 --u32 &quot;5&amp;0xFF=0x7F&quot; -j DROP
iptables -I FORWARD -p tcp -m tcp --sport 8080 -m u32 --u32 &quot;5&amp;0xFF=0x7F&quot; -j DROP
iptables -I FORWARD -p tcp -m tcp --sport 80 -m u32 --u32 &quot;5&amp;0xFF=0x80&quot; -j DROP
iptables -I FORWARD -p tcp -m tcp --sport 8000 -m u32 --u32 &quot;5&amp;0xFF=0x80&quot; -j DROP
iptables -I FORWARD -p tcp -m tcp --sport 8080 -m u32 --u32 &quot;5&amp;0xFF=0x80&quot; -j DROP

# OpenWRT 防火墙自定义设置劫持 DNS 解析
iptables -t nat -A PREROUTING -p udp --dport 53 -j REDIRECT --to-ports 53
iptables -t nat -A PREROUTING -p tcp --dport 53 -j REDIRECT --to-ports 53

# HTTP 头部 User-Agent 修改
iptables -t nat -N PrivoxyUA
iptables -t nat -A PREROUTING -i br-lan -p tcp -j PrivoxyUA
iptables -t nat -A PrivoxyUA -d 0.0.0.0/8 -j RETURN
iptables -t nat -A PrivoxyUA -d 10.0.0.0/8 -j RETURN
iptables -t nat -A PrivoxyUA -d 127.0.0.0/8 -j RETURN
iptables -t nat -A PrivoxyUA -d 169.254.0.0/16 -j RETURN
iptables -t nat -A PrivoxyUA -d 192.168.1.0/24 -j RETURN
iptables -t nat -A PrivoxyUA -d 172.16.0.0/12 -j RETURN
iptables -t nat -A PrivoxyUA -d 192.168.0.0/16 -j RETURN
iptables -t nat -A PrivoxyUA -d 224.0.0.0/4 -j RETURN
iptables -t nat -A PrivoxyUA -d 240.0.0.0/4 -j RETURN
iptables -t nat -A PrivoxyUA -p tcp --dport 80 -j REDIRECT --to-ports 8118
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),j={href:"http://ua.233996.xyz/",target:"_blank",rel:"noopener noreferrer"},I=e("blockquote",null,[e("p",null,[e("strong",null,"Warning"),n(" 警告：你可以先在电脑上测试，否则如果一旦不能成功修改 UA 极有可能被校园网检测到共享流量而被断网甚至封禁！")])],-1),C=e("p",null,"至此防检测基本完成，如果路由器性能允许也可以直接使用诸如 Clash 或 V2Ray 来全局代理，免去配置 Privoxy 的问题，这里因为路由器性能所限就不做介绍了。",-1);function D(W,L){const i=a("ExternalLinkIcon");return r(),o("div",null,[u,p,v,d(" more "),b,m,e("ul",null,[e("li",null,[e("a",_,[n("GL.iNet 天猫旗舰店页面"),t(i)])]),e("li",null,[e("a",h,[n("本人购买的路由器：SFT1200（购买时是带适配器，折后价格为 219 人民币（购买日期 2022/09/21））"),t(i)])]),g]),x,R,e("p",null,[n("输入 "),e("a",f,[n("http://192.168.8.1/"),t(i)]),n(" 进入路由器管理页面，在配置好相关设置之后点击 更多设置 -> MAC 地址克隆：")]),A,P,y,e("blockquote",null,[e("p",null,[n("此处采用的是 "),e("a",T,[n("LilyNas 大佬的博客文章"),t(i)]),n("来配置的，这里稍微整理一下总结一下步骤")])]),U,e("p",null,[n("打开 LuCi 控制台，进入 "),e("a",k,[n("Privoxy 网络代理"),t(i)])]),E,e("p",null,[n("之后回到 "),e("a",N,[n("Privoxy 网络代理"),t(i)]),n(" 页面，在 系统 子页面里启动 Privoxy，如果显示了 PID 则表示代理已正常运行。 如果没有，请在 日志查看器 里查阅错误日志，在评论区里评论，让大家帮你解决一下问题。")]),q,e("p",null,[n("进入 "),e("a",F,[n("OpenWRT 网络 -> 防火墙 -> 自定义规则"),t(i)]),n("，在原内容尾部加入以下信息：")]),O,e("p",null,[n("重启路由器，手机连接路由器网络，通过 "),e("a",j,[n("UA 检测网站"),t(i)]),n("检测头部系统信息是否能和电脑一致")]),I,C])}const w=l(c,[["render",D],["__file","2022-10-11-使用 GL.iNet 出品的路由器进行校园网共享网络的教程.html.vue"]]);export{w as default};
